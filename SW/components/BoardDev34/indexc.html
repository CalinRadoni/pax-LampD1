<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
<style>
* { box-sizing: border-box; }
.tab { overflow: hidden; border: 1px solid #ccc; background-color: #eee; }
.tab button {
 float: left; border: none; outline: none;
 background-color: inherit; cursor: pointer; transition: 0.3s;
 font-size: 1em; padding: 1em 1rem;
}
.tab button:hover { background-color: #ddd; }
.tab button.active { background-color: #ccc; }
.tabBody { display: none; padding: 0.5rem 1rem; border: 1px solid #ccc; border-top: none; }
.btnr:after { content: ""; display: table; clear: both; }
.btnc {
 border: none; color: black;
 cursor: pointer;
 float: left; width: 16.66%; height: 3rem;
}
</style>
<script src="jquery.js"></script>
<script>
function openTab(evt, cityName) {
 var i, tabBody, tabLink;
 tabBody = document.getElementsByClassName('tabBody');
 for (i = 0; i < tabBody.length; i++) { tabBody[i].style.display = "none"; }
 tabLink = document.getElementsByClassName('tabLink');
 for (i = 0; i < tabLink.length; i++) { tabLink[i].className = tabLink[i].className.replace(" active", ""); }
 document.getElementById(cityName).style.display = "block";
 evt.currentTarget.className += " active";
}

function PostPOST(cmdID) {
 var userData = $("#CCode").val();
 if (!userData) userData = 0;

      if (cmdID == 0) { $("#sTxt").text("Turn off ..."); }
 else if (cmdID == 1) { $("#sTxt").text("Set color ..."); }
 else                 { $("#sTxt").text(""); }

 var qurl = "/do.json";

 $.ajax({
  url: qurl, dataType: "json", method: "POST", cache: false,
  headers: { "X-User-Cmd": cmdID, "X-User-Data": userData },
  data: { "id":cmdID }
 })
 .fail(function(xhr, status, error) { $("#sTxt").text(xhr.statusText); });
}

function SetColor() { PostPOST(1); }
function TurnOff()  { PostPOST(0); }
function PClick(cdiv) {
 document.getElementById('CCode').value = cdiv.getAttribute("name");
 PostPOST(1);
}

var nRGB = ["800000","804000","808000","408000","008000","008040","008080","004080","000080","400080","800080","800040"];
var nRYB = ["7F1208","7F2F05","7C4B01","7F660C","7F7F19","596B18","325718","1A3E4C","01227F","22126B","440159","600A2F"];
var pRGB = ["FF0000","FF8000","FFFF00","80FF00","00FF00","00FF80","00FFFF","0080FF","0000FF","8000FF","FF00FF","FF0080"];
var pRYB = ["FE2712","FC600A","FB9902","FCCC1A","FEFE33","B2D732","66B032","347C98","0247FE","4424D6","8601AF","C21460"];
function CreateSmallColorWheel(id, parentID) {
 var mdiv = document.getElementById(parentID);
 var nn = id==0 ? nRGB : nRYB;
 var pp = id==0 ? pRGB : pRYB;
 var i, rdiv;
 for (i = 0; i < pp.length; i++) {
  if ((i % 6) == 0) { rdiv = document.createElement("div"); rdiv.setAttribute("class", "btnr"); mdiv.appendChild(rdiv); }
  rdiv.innerHTML += '<div class="btnc" name="' + nn[i] + '" onclick="PClick(this)" style="background-color:#' + pp[i] +';"></div>';
 }
}

function swfC(ii) {
 if (!(ii && ii.files)) return;
 var f = ii.files[0];
 if (!f) return;
 var d = document.getElementById('swf');
 if (d) { d.innerHTML = f.name + "<br/>size: " + f.size + " bytes"; }
}

function UpFW() {
 var fs = document.getElementById('fwf');
 if (!(fs && fs.files)) return;
 var f = fs.files[0];
 if (!f) return;
 var ii = document.getElementById('swi');

 var xhttp = new XMLHttpRequest();
 xhttp.onreadystatechange = function() {
  if (xhttp.readyState == 4) {
   if (xhttp.status == 200) { ii.innerHTML = xhttp.responseText; }
   else { ii.innerHTML = "Error " + xhttp.status + " " + xhttp.responseText; }
  }
 }
 xhttp.upload.addEventListener("progress", function(ev) {
  if (ev.lengthComputable) {
   var percent = 100 * ev.loaded / ev.total | 0;
   ii.innerHTML = percent + "%";
  }
 });
 xhttp.open("POST", "/upfw", true);
 xhttp.send(f);
}

function ResetBoard() { PostPOST(0xFE); }

$(document).ready(function() {
 CreateSmallColorWheel(0, 'pRGB');
 CreateSmallColorWheel(1, 'pRYB');
});
</script>
<title>pax-LampD1</title>
</head>
<body>
 <div class="tab">
  <button class="tabLink" onclick="openTab(event, 'TH')">Home</button>
  <button class="tabLink" onclick="openTab(event, 'TP')">Colors</button>
  <button class="tabLink" onclick="openTab(event, 'TC')">Custom</button>
  <button class="tabLink" onclick="openTab(event, 'TS')">Settings</button>
 </div>
 <div id="TH" class="tabBody active" style="display: block;">
  <h3>Enter color code in hex</h3><br/>
  <input id="CCode" type="text" value="" maxlength="8" size="8">&nbsp;
  <input type="button" value="Set" onclick="SetColor()" />&nbsp;
  <input type="button" value="Off" onclick="TurnOff()" />
  <br/><br/>
  <span id="sTxt"></span>
 </div>
 <div id="TP" class="tabBody">
  <h3>RGB</h3><div id="pRGB"></div><br/>
  <h3>RYB</h3><div id="pRYB"></div>
 </div>
 <div id="TC" class="tabBody"></div>
 <div id="TS" class="tabBody">
  <h3>Firmware</h3>
  <input type="file" id="fwf" accept=".bin" style="display:none" onchange="swfC(this)" />
  <input type="button" value="Select firmware file" onclick="document.getElementById('fwf').click();" /> &gt;&gt;
  <input type="button" value="Upload firmware" onclick="UpFW()" /> &gt;&gt;
  <input type="button" value="Reset" onclick="ResetBoard()" /><br/>
  <div id="swf"></div><br/>
  <div id="swi"></div>
 </div>
</body>
</html>

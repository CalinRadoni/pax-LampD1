<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
<style>
* { box-sizing: border-box; margin: 0; padding: 0 }
body { margin: 0 auto; max-width: 1024px }
h3 { padding-bottom: 0.5em }
.title { background-color: #6495ed; color: #fff; padding: 1em }
.tab { overflow: hidden; background-color: #eee; color: #222 }
.tab button {
 float: left; border: none; outline: none;
 background-color: inherit; cursor: pointer; transition: 0.3s;
 font-size: 1em; padding: 1em 1rem;
}
.tab button:hover { background-color: #ccc }
.tab button.active { background-color: #6495ed; color: #fff }
.tabBody { display: none; padding: 1rem }
.btnr:after { content: ""; display: table; clear: both }
.btnc {
 border: none; color: black;
 cursor: pointer;
 float: left; width: 16.66%; height: 3rem;
}
</style>
<!--<script src="jquery.js"></script>-->
<script>
function openTab(evt, tabID) {
 var i, tabBody, tabLink;
 tabBody = document.getElementsByClassName('tabBody');
 for (i = 0; i < tabBody.length; i++) { tabBody[i].style.display = "none"; }
 tabLink = document.getElementsByClassName('tabLink');
 for (i = 0; i < tabLink.length; i++) { tabLink[i].className = tabLink[i].className.replace(" active", ""); }
 document.getElementById(tabID).style.display = "block";
 evt.currentTarget.className += " active";
}

function SendCmd(cmdID) {
 var ii = document.getElementById('sTxt');
 var cmdData = document.getElementById('CCode').value;
 var xhr = new XMLHttpRequest();

 xhr.onload = function() {
  if (xhr.readyState === xhr.DONE) {
   if (xhr.status === 200) { ii.innerHTML = xhr.responseText; }
  }
 }
 xhr.onerror = function() { ii.innerHTML = "Send error"; }
 xhr.onabort = function() { ii.innerHTML = "Send canceled"; }

 xhr.open("POST", "/cmd.json", true);
 xhr.setRequestHeader("Content-Type", "application/json;charset=UTF-8");
 xhr.send(JSON.stringify({ "cmd": cmdID, "data": cmdData }));
}

function SetColor() { SendCmd(1); }
function TurnOff()  { SendCmd(0); }
function PClick(cdiv) {
 document.getElementById('CCode').value = cdiv.getAttribute("name");
 SendCmd(1);
}
function ResetBoard() { SendCmd(0xFE); }

var nRGB = ["800000","804000","808000","408000","008000","008040","008080","004080","000080","400080","800080","800040"];
var nRYB = ["7F1208","7F2F05","7C4B01","7F660C","7F7F19","596B18","325718","1A3E4C","01227F","22126B","440159","600A2F"];
var pRGB = ["FF0000","FF8000","FFFF00","80FF00","00FF00","00FF80","00FFFF","0080FF","0000FF","8000FF","FF00FF","FF0080"];
var pRYB = ["FE2712","FC600A","FB9902","FCCC1A","FEFE33","B2D732","66B032","347C98","0247FE","4424D6","8601AF","C21460"];
function CreateSmallColorWheel(id, parentID) {
 var mdiv = document.getElementById(parentID);
 var nn = id==0 ? nRGB : nRYB;
 var pp = id==0 ? pRGB : pRYB;
 var i, rdiv;
 for (i = 0; i < pp.length; i++) {
  if ((i % 6) == 0) { rdiv = document.createElement("div"); rdiv.setAttribute("class", "btnr"); mdiv.appendChild(rdiv); }
  rdiv.innerHTML += '<div class="btnc" name="' + nn[i] + '" onclick="PClick(this)" style="background-color:#' + pp[i] +';"></div>';
 }
}

function swfC(ii) {
 if (!(ii && ii.files)) return;
 var f = ii.files[0];
 if (!f) return;
 var d = document.getElementById('swf');
 if (d) { d.innerHTML = f.name + "<br/>size: " + f.size + " bytes"; }
}

function UpFW() {
 var fs = document.getElementById('fwf');
 if (!(fs && fs.files)) return;
 var f = fs.files[0];
 if (!f) return;
 var ii = document.getElementById('swi');

 var xhr = new XMLHttpRequest();
 xhr.onreadystatechange = function() {
  if (xhr.readyState === xhr.DONE) {
   if (xhr.status === 200) { ii.innerHTML = xhr.responseText; }
   else { ii.innerHTML = "Error " + xhr.status + " " + xhr.responseText; }
  }
 }
 xhr.upload.addEventListener("progress", function(ev) {
  if (ev.lengthComputable) {
   var percent = 100 * ev.loaded / ev.total | 0;
   ii.innerHTML = percent + "%";
  }
 });
 xhr.open("POST", "/upfw", true);
 xhr.send(f);
}

function Init() {
 CreateSmallColorWheel(0, 'pRGB');
 CreateSmallColorWheel(1, 'pRYB');
}
</script>
<title>pax-LampD1</title>
</head>
<body onload="Init();">
 <div class="title">
  <h1>pax-LampD1</h1>
 </div>
 <div class="tab">
  <button class="tabLink active" onclick="openTab(event, 'TH')">Home</button>
  <button class="tabLink" onclick="openTab(event, 'TP')">Colors</button>
  <button class="tabLink" onclick="openTab(event, 'TS')">Settings</button>
 </div>
 <div id="TH" class="tabBody" style="display: block;">
  <h3>Enter color code in hex</h3>
  <input id="CCode" type="text" value="" maxlength="8" size="8">&nbsp;
  <input type="button" value="Set" onclick="SetColor()" />&nbsp;
  <input type="button" value="Off" onclick="TurnOff()" />
  <br/><br/>
  <span id="sTxt"></span>
 </div>
 <div id="TP" class="tabBody">
  <h3>RGB</h3><div id="pRGB"></div><br/>
  <h3>RYB</h3><div id="pRYB"></div>
 </div>
 <div id="TS" class="tabBody">
  <h3>Firmware</h3>
  <input type="file" id="fwf" accept=".bin" style="display:none" onchange="swfC(this)" />
  <input type="button" value="Select firmware file" onclick="document.getElementById('fwf').click();" /> &gt;&gt;
  <input type="button" value="Upload firmware" onclick="UpFW()" /> &gt;&gt;
  <input type="button" value="Reset" onclick="ResetBoard()" /><br/>
  <div id="swf"></div><br/>
  <div id="swi"></div>
 </div>
</body>
</html>
